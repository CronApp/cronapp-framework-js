!function($app){var patternFormat=function(e){return e?$(e).attr("format")||"DD/MM/YYYY":"DD/MM/YYYY"},parsePermission=function(e){var t={visible:{public:!0},enabled:{public:!0}};if(e)for(var i=e.toLowerCase().trim().split(","),n=0;n<i.length;n++){var r=i[n].trim();if(r){var a=r.split(":");if(2==a.length){var o=a[0].trim(),s=a[1].trim();if(s){for(var l=s.split(";"),c={},d=0;d<l.length;d++){var p=l[d].trim();p&&(c[p]=!0)}t[o]=c}}}}return t};app.directive("asDate",function(){return{require:"^ngModel",restrict:"A",link:function(e,t,i,n){function r(){var e=t.val(),i=moment(e,patternFormat(t));i.isValid()&&n.$setViewValue(i.toDate())}if(n){var a=patternFormat(t),o={format:a,locale:"pt-BR",showTodayButton:!0,useStrict:!0,tooltips:{today:"Hoje",clear:"Limpar seleção",close:"Fechar",selectMonth:"Selecionar mês",prevMonth:"Mês anterior",nextMonth:"Próximo mês",selectYear:"Selecionar ano",prevYear:"Ano anterior",nextYear:"Próximo ano",selectDecade:"Selecionar década",prevDecade:"Década anterior",nextDecade:"Próxima década",prevCentury:"Século anterior",nextCentury:"Próximo século"}};"DD/MM/YYYY"!=a&&(o.sideBySide=!0),t.datetimepicker(o),t.on("dp.change",function(){$(this).is(":visible")&&e.$apply(r)}),n.$render=function(){if(n.$viewValue){var e=moment(n.$viewValue);if(e.isValid())t.val(e.format(patternFormat(t)));else{var i=parseInt(n.$viewValue,10);e=moment(i),e.isValid()?t.val(e.format(patternFormat(t))):t.val("")}}else t.data("DateTimePicker").clear(),t.val("")},r()}}}}).directive("ngDestroy",function(){return{restrict:"A",link:function(scope,element,attrs,ctrl){element.on("$destroy",function(){attrs.ngDestroy&&attrs.ngDestroy.length>0&&(attrs.ngDestroy.indexOf("app.")>-1||attrs.ngDestroy.indexOf("blockly.")>-1?scope.$eval(attrs.ngDestroy):eval(attrs.ngDestroy))})}}}).directive("dynamicImage",function(e){return{restrict:"E",replace:!0,scope:{label:"@",ngModel:"@",width:"@",height:"@"},require:"ngModel",template:"<div></div>",init:function(e){e.ngModel||(e.ngModel=""),e.width||(e.width="128"),e.height||(e.height="128"),this.containsLetter(e.width)||(e.width+="px"),this.containsLetter(e.height)||(e.height+="px")},containsLetter:function(e){for(var t,i=0;i<e.length;i++){t=!0;for(var n=0;n<10;n++)parseInt(e[i])==n&&(t=!1);if(t)break}return t},link:function(t,i,n){this.init(t);var r=t;i.append('<div class="form-group upload-image-component" ngf-drop="" ngf-drag-over-class="dragover">                                  <img style="max-height: $height$; max-width: $width$;" ng-if="$ngModel$" data-ng-src="{{\'data:image/png;base64,\' + $ngModel$}}">                                  <img style="max-height: $height$; max-width: $width$;" ng-if="!$ngModel$" data-ng-src="{{datasource.noImageUpload}}" class="btn" ng-if="!$ngModel$" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.setFile(\'$ngModel$\', $file)" accept="image/*">                                  <div class="remove btn btn-danger btn-xs" ng-if="$ngModel$" ng-click="$ngModel$=null">                                    <span class="glyphicon glyphicon-remove"></span>                                  </div>                                </div>'.split("$height$").join(r.height).split("$width$").join(r.width).split("$ngModel$").join(r.ngModel)),e(i)(i.scope())}}}).directive("pwCheck",[function(){"use strict";return{require:"ngModel",link:function(e,t,i,n){var r="#"+i.pwCheck;t.add(r).on("keyup",function(){e.$apply(function(){var e=t.val()===$(r).val();n.$setValidity("pwmatch",e)})})}}}]).directive("valid",function(){return{require:"^ngModel",restrict:"A",link:function(e,t,i,n){var r={cpf:CPF,cnpj:CNPJ};n.$validators[i.valid]=function(e,n){var a=e||n,o=r[i.valid].isValid(a);return o?t[0].setCustomValidity(""):t[0].setCustomValidity(t[0].dataset.errorMessage),o||!a}}}}).directive("cronappSecurity",function(){return{restrict:"A",link:function(e,t,i){var n=[];e.session&&e.session.roles&&(n=e.session.roles.toLowerCase().split(","));for(var r=parsePermission(i.cronappSecurity),a=!1,o=!1,s=0;s<n.length;s++){var l=n[s].trim();l&&(r.visible[l]&&(a=!0),r.enabled[l]&&(o=!0))}a||$(t).hide(),o||$(t).find("*").addBack().attr("disabled",!0)}}})}(app);