!function(t){angular.module("report.services",[]).service("ReportService",["$http","$compile","$modal",function(t,e,r){var o=$("body"),n=angular.element(o.get(0)).scope();this.getReport=function(e){var r={url:"api/rest/report",method:"POST",data:angular.toJson({reportName:e})};return t(r)},this.getPDF=function(e){var r={url:"api/rest/report/pdf",method:"POST",responseType:"arraybuffer",data:angular.toJson(e)};return t(r)},this.getPDFAsFile=function(e){var r={url:"api/rest/report/pdfasfile",method:"POST",data:angular.toJson(e)};return t(r)},this.openURLContent=function(t){var r=$("#reportViewContext");r.get(0)||(console.log("include[#reportViewContext]"),o.append('<div id="reportViewContext" ng-include="\'plugins/cronapp-framework-js/components/reports/reports.view.html\'"></div>'),e(o)(n));var a=function(){var e=$("<iframe/>");e.attr("frameborder",0);var o=parseInt($(window).height());e.attr("height",o-200),e.attr("width","100%"),e.attr("src",t+"?download=false");var n=$("#reportView .modal-body");n.get(0)?(n.html(e),$("#reportViewContext .modal-dialog").css("width","95%"),setTimeout(function(){console.log("open[#reportViewContext]"),$("body").append(r),$("#reportView").modal()},100)):(console.log("wait[#reportViewContext]"),setTimeout(a,200))};setTimeout(a,200)},this.showParameters=function(t){var e=t.parameters,o=[],n=0,a=function(t){return t.replace(/([.*+?^=!:()|\[\]\/\\])/g,"\\$1")},i=function(t,e,r){return t.replace(new RegExp(a(e),"g"),r)},s=function(){if(n<e.length){var a=e[n++];$.get("plugins/cronapp-framework-js/components/reports/"+a.type+".parameter.html").done(function(t){o.push(i(t,"_field_",a.name)),s()})}else o.length>0&&r.open({templateUrl:"plugins/cronapp-framework-js/components/reports/reports.parameters.html",controller:"ParameterController",resolve:{report:function(){return JSON.parse(JSON.stringify(t))},htmlParameters:function(){return JSON.parse(JSON.stringify(o))}}})}.bind(this);s()},this.openReport=function(t){this.getReport(t).then(function(t){t&&t.data&&(0==t.data.parameters.length||1==t.data.parameters.length&&"DATA_LIMIT"==t.data.parameters[0].name?this.getPDFAsFile(t.data.reportName).then(function(t){this.openURLContent(t.data)}.bind(this),function(t){var e=cronapi.internal.getErrorMessage(t,t.statusText);n.Notification.error(e)}.bind(this)):this.showParameters(JSON.parse(JSON.stringify(t.data))))}.bind(this))}}])}(app);